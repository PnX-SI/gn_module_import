<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">Liste des imports</h5>
        </div>
        <div class="card-body">
            <div *ngIf="!empty">
                <input
                    [formControl]="search"
                    id="search"
                    type="text"
                    class="form-control"
                    placeholder="Search"
                    aria-label="Search"
                    aria-describedby="basic-addon1"
                />
                <ngx-datatable
                    #table
                    class="material striped"
                    [rows]="filteredHistory"
                    [columnMode]="'force'"
                    [headerHeight]="35"
                    [footerHeight]="30"
                    [rowHeight]="40"
                    [externalPaging]="true"
                    [count]="total"
                    [offset]="offset"
                    [limit]="limit"
                    (page)="setPage($event)"
                    (sort)="onSort($event)"
                >
                    <ngx-datatable-column
                        *ngFor="let col of config.LIST_COLUMNS_FRONTEND"
                        name="{{col.name}}"
                        [prop]="col.prop"
                        [maxWidth]="col.max_width"
                        [sortable]="col.filter"
                    >
                        <div *ngIf="col.prop=='dataset.dataset_name'">
                            <ng-template
                                let-row="row"
                                ngx-datatable-cell-template
                            >
                                <a
                                    routerLink="/metadata/dataset_detail/{{row.id_dataset}}"
                                    matTooltip="{{col.name}}"
                                >{{row.dataset.dataset_name}}</a>
                            </ng-template>
                        </div>
                        <div *ngIf="col.prop=='date_create_import'">
                            <ng-template
                                let-row="row"
                                ngx-datatable-cell-template
                            >
                                {{row.date_create_import |date:'dd-MM-yyyy'}}
                            </ng-template>
                        </div>
                    </ngx-datatable-column>
                    <ngx-datatable-column
                        maxWidth="200"
                        name="Fin import"
                        [sortable]="true"
                        prop="date_end_import"
                        class="date-col"
                    >
                        <ng-template
                            let-row="row"
                            ngx-datatable-cell-template
                        >
                            <p *ngIf="row.date_end_import">{{row.date_end_import |date:'dd-MM-yyyy'}}</p>
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column
                        name="Actions"
                        [sortable]="true"
                    >
                        <ng-template
                            let-row="row"
                            ngx-datatable-cell-template
                        >
                            <button
                                [disabled]="!row?.cruved?.U || !row?.dataset?.active"
                                matTooltip="Modifier l’import"
                                mat-icon-button
                                color="primary"
                                *ngIf="!row.processing"
                                style="margin-top: -10px;"
                                (click)="onFinishImport(row)"
                            >
                                <mat-icon>edit</mat-icon>
                            </button>
                            <button
                                *ngIf="row.errors_exists"
                                matTooltip="Rapport d'erreur"
                                mat-icon-button
                                color="warn"
                                style="margin-top: -10px;"
                                [routerLink]="[row.id_import, 'errors']"
                            >
                                <mat-icon>warning</mat-icon>
                            </button>
                            <button
                                *ngIf="row.errors_exists"
                                mat-icon-button
                                color="primary"
                                style="margin-top: -10px;"
                                (click)="_csvExport.onCSV(row.id_import)"
                                matTooltip='Téléchargement des données invalides'
                            >
                                <mat-icon>download</mat-icon>
                            </button>
                            <button
                                [disabled]="!row?.cruved?.D || !row?.dataset?.active"
                                mat-icon-button
                                color=warn
                                style="margin-top: -10px;"
                                (click)="openDeleteModal(row, deleteModal)"
                                matTooltip="Supprimer l’import"
                            >
                                <mat-icon>delete</mat-icon>
                            </button>
                        </ng-template>
                    </ngx-datatable-column>
                </ngx-datatable>
            </div>
            <div *ngIf="empty">
                Vous n'avez effectué aucun import
            </div>
            <import-modal-dataset class="pull-right mt-3"></import-modal-dataset>

            <ng-template
                #deleteModal
                let-c="close "
                let-d="dismiss"
            >

                <import-delete
                    [row]="deleteOne"
                    [c]="c"
                    (onDelete)="onImportList()"
                >
                </import-delete>

            </ng-template>
        </div>
    </div>
</div>
