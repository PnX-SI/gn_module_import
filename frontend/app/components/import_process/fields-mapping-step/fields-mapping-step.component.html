    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0"> Correspondance des champs avec le modèle </h5>
        </div>
        <div
            *ngIf="formReady"
            class="card-body"
        >
            <!-- Choix de la liste des nomenclatures -->
            <form>
                <fieldset>
                    <div *ngIf="userFieldMappings.length > 0" class="form-group">
                        <legend class="px-1">
                            Choix d’un modèle d'import prédéfini
                        </legend>
                        <select
                            class="form-control"
                            id="mappingSelection"
                            [formControl]="fieldMappingForm"
                            [compareWith]="areMappingFieldEqual"
                            [disableControl]="userFieldMappings.length <= 1"
                        >
                            <option [ngValue]="null"> </option>
                            <option
                                *ngFor="let fieldMapping of userFieldMappings"
                                [ngValue]="fieldMapping"
                            >
                                {{fieldMapping.mapping_label}}</option>
                        </select>
                    </div>

                    <div class="d-flex flex-row justify-content-between mt-3">

                        <div class="d-flex justify-content-center align-content-between">
                            <button
                                *ngIf="canCreateMapping"
                                class="mb-3"
                                mat-raised-button
                                color="primary"
                                (click)="showCreateMappingForm()"
                            >
                                Nouveau modèle d'import
                            </button>
                            <button
                                *ngIf="canRenameMapping"
                                class="btn-sm mb-3 ml-1"
                                mat-raised-button
                                color="primary"
                                (click)="showRenameMappingForm()"
                                [disabled]="!renameMappingEnabled()"
                            >
                                Renomer le modèle d'import
                            </button>
                            <button
                                *ngIf="canDeleteMapping"
                                class="btn-sm mb-3 ml-1"
                                mat-raised-button
                                color="warn"
                                (click)="deleteMapping()"
                                [disabled]="!deleteMappingEnabled()"
                            >
                                Supprimer le modèle d'import
                            </button>
                        </div>


                        <div
                            *ngIf="this.IMPORT_CONFIG.DISPLAY_CHECK_BOX_MAPPED_FIELD"
                            class="form-check"
                        >
                            <input
                                type="checkbox"
                                [(ngModel)]="displayAllValues"
                                [ngModelOptions]="{standalone: true}"
                            >
                            Afficher les champs automatiquement associés
                        </div>
                    </div>

                    <div
                        *ngIf="createMappingFormVisible"
                        class="d-flex flex-row justify-content-between form_group"
                        id="newMap"
                    >
                        <input
                            type="text"
                            class="form-control mr-2"
                            value="Inconnu"
                            [formControl]="createOrRenameMappingForm"
                        >
                        <button
                            class="d-flex justify-content-center align-content-between mr-2 button-success"
                            mat-raised-button
                            matTooltip="Créer un nouveau mapping"
                            (click)="createMapping(createOrUpdateMappingForm.value)"
                            [disabled]="!createOrRenameMappingForm.valid"
                        >
                            <mat-icon>add</mat-icon>
                        </button>
                        <button
                            class="d-flex justify-content-center align-content-between"
                            mat-raised-button
                            color=warn
                            (click)="hideCreateOrRenameMappingForm()"
                        >
                            Annuler
                        </button>
                    </div>

                    <div
                        *ngIf="renameMappingFormVisible"
                        class="d-flex flex-row justify-content-between form_group"
                        id="updateMap"
                    >
                        <input
                            type="text"
                            class="form-control mr-2"
                            value="Inconnu"
                            [formControl]="createOrRenameMappingForm"
                        >
                        <button
                            class="d-flex justify-content-center align-content-between mr-2 button-success"
                            (click)="updateMappingName(createOrRenameMappingForm.value)"
                            mat-raised-button
                            matTooltip="Modifier le nom du modèle d'import"
                            [disabled]="!createOrRenameMappingForm.valid"
                        >
                            <mat-icon>check</mat-icon>
                        </button>
                        <button
                            matTooltip="Annuler la modification du nom du modèle d'import"
                            class="d-flex justify-content-center align-content-between"
                            (click)="hideCreateOrRenameMappingForm()"
                            mat-raised-button
                            color="warn"
                        >
                            Annuler
                        </button>
                    </div>

                    <div *ngIf="fieldMappingForm.value != null">
                        <div
                            *ngIf="mappedTargetFields.size > 0"
                            class="alert alert-success"
                            role="alert"
                            style="text-align: center;"
                        >
                           {{ mappedTargetFields.size }} champs cibles ont été associé à un champs source.
                        </div>
                        <div
                            *ngIf="unmappedSourceFields.size == 0"
                            class="alert alert-success"
                            role="alert"
                            style="text-align: center;"
                        >
                            L'ensemble des {{ mappedSourceFields.size }} champs du fichier d’import ont été associés à un champs cible.
                        </div>
                        <div
                            *ngIf="unmappedSourceFields.size > 0"
                            class="alert alert-warning"
                            role="alert"
                            style="text-align: center;"
                        >
                            <a data-toggle="collapse" href="#unmappedSourceFields" aria-expanded="false" aria-controls="unmappedSourceFields">
                              {{ unmappedSourceFields.size }} champs
                            </a> du fichier d’import ne sont actuellement associé à aucun champs cible et seront donc ignorés.
                            <div class="collapse" id="unmappedSourceFields">
                              <ul style="text-align: left;">
                                <li *ngFor="let sourceField of unmappedSourceFields">{{ sourceField }}</li>
                              </ul>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </form>
            <form [formGroup]="syntheseForm">
                <div *ngFor="let theme of targetFields">
                    <fieldset>
                        <legend class="px-1">
                            {{theme.theme.fr_label_theme}}
                        </legend>
                        <div class="row m-0">
                            <ng-container *ngFor="let field of theme.fields">
                                <div
                                    class="col-6"
                                >
                                    <div
                                        *ngIf="!field.autogenerated"
                                        class="form-group"
                                    >
                                        <small>{{field.fr_label}} :
                                            <i
                                                *ngIf="field.comment"
                                                matTooltip="{{field.comment}}"
                                                matTooltipClass="custom-tooltip"
                                                class="fa fa-info-circle"
                                                aria-hidden="true"
                                            ></i>

                                        </small>
                                        <select
                                            class="form-control form-control-sm"
                                            id="{{field.name_field}}"
                                            placeholder="Open this select menu"
                                            formControlName="{{field.name_field}}"
                                        >
                                            <option [ngValue]="null"></option>
                                            <option
                                                *ngFor="let sourceField of sourceFields.sort()"
                                                [value]="sourceField"
                                            >
                                                {{ sourceField }}
                                            </option>
                                        </select>
                                        <div
                                            *ngIf="syntheseForm.controls[field.name_field].hasError('required')"
                                            class="invalid-feedback d-block"
                                        >Sélectionnez
                                            {{field.name_field}}</div>
                                        <div *ngIf="field.name_field=='WKT'">
                                            <small>*si pas de WKT, indiquez longitude et latitude.</small>
                                        </div>

                                        <div
                                            *ngIf="syntheseForm.controls[field.name_field].hasError('conflict')"
                                            class="invalid-feedback d-block"
                                        >{{ syntheseForm.controls[field.name_field].getError('conflict') }}</div>
                                    </div>
                                    <div
                                        *ngIf="field.autogenerated"
                                        class="form-group"
                                    >
                                        <label for="auto_check"> <small>{{field.fr_label}} :</small> </label>
                                        <input
                                            type="checkbox"
                                            id="auto_check"
                                            formControlName="{{field.name_field}}"
                                        >
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </fieldset>
                </div>
                <br>
                <div class="d-flex flex-row justify-content-between">
                    <button
                        mat-raised-button
                        class="d-flex justify-content-center align-content-between"
                        (click)="onPreviousStep()"
                        color="primary"
                    >
                        <mat-icon>navigate_before</mat-icon>

                        Précédent
                    </button>
                    <button
                        class="d-flex justify-content-center align-content-between"
                        mat-raised-button
                        color="primary"
                        [disabled]="!isNextStepAvailable()"
                        (click)='onNextStep()'
                    >
                        Suivant
                        <mat-icon>navigate_next</mat-icon>
                    </button>

                </div>
            </form>


        </div>
<!-- Spinner -->
<div
    *ngIf="spinner"
    class="spinner"
>
    <mat-spinner
        class="upload-spinner"
        [color]="color"
        [diameter]="150"
        [strokeWidth]="12"
    >
    </mat-spinner>
</div>


<ng-template
    #saveMappingModal
    let-modal
>

    <div class="modal-header">
        <h4
            class="modal-title"
            id="modal-basic-title"
        >Enregistrement du modèle</h4>
        <button
            type="button"
            class="close"
            aria-label="Close"
            (click)="modal.dismiss('Cross click')"
        >
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        Attention, le modèle a été modifié, voulez-vous sauvegarder ces modifications ?
        <form *ngIf="this.fieldMappingForm.value">
          <div class="form-group">
            <label for="mappingName">Nom du mapping</label>
            <input [formControl]="modalCreateMappingForm" class="form-control" id="mappingName" placeholder="Nom du mapping">
          </div>
        </form>
    </div>
    <div class="modal-footer">
        <button
            type="button"
            mat-raised-button
            color="accent"
            (click)="modal.close(); submitMapping(false)"
        > Continuer sans enregistrer </button>
        <button
            *ngIf="this.fieldMappingForm.value && this.createOrRenameMappingForm.value == ''"
            type="button"
            mat-raised-button
            color="primary"
            (click)="modal.close(); submitMapping(true)"
        > Mettre à jour le modèle existant </button>
        <button
            *ngIf="this.fieldMappingForm.value == null || this.createOrRenameMappingForm.value != ''"
            type="button"
            mat-raised-button
            color="primary"
            (click)="modal.close(); submitMapping(true, 'hop')"
        > Enregistrer un nouveau modèle </button>
    </div>
</ng-template>
